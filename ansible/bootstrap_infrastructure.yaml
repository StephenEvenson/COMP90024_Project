- hosts: localhost
  vars_files:
    - host-vars/instance_vars.yaml
  gather_facts: true

  roles:
    - role: openstack-volume
    # - role: openstack-security-group
    - role: openstack-instance

# Install Docker on all hosts
- hosts: AllNodes
  vars_files:
   - host-vars/couchdb_vars.yaml
  gather_facts: true

  roles:
   - role: nodes-common
   - role: nodes-docker-install
   - role: nodes-volume-mount

# Install Docker and CouchDB
- hosts: DbNodes
  vars_files:
   - host-vars/couchdb_vars.yaml
  gather_facts: true

  roles:
   - role: couchdb-setup

# Perform CouchDB configuration on all hosts except Masternode
- hosts: OtherNodes
  vars_files:
   - host-vars/couchdb_vars.yaml
  gather_facts: true

  roles:
   - role: couchdb-finish-setup

- hosts: ServerNodes[0]
  gather_facts: true

  roles:
    - role: db-load-balancer-setup

- hosts: ServerNodes[0]
  vars_files:
    - host-vars/server_vars.yaml
  gather_facts: true

  roles:
    - role: nlp-server-setup
    - role: mastodon-setup
    - role: backend-setup
    - role: frontend-setup